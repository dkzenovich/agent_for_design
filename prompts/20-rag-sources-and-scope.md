---
mode: 'agent'
description: 'Сопоставить инфопотребности с источниками и оценить их пригодность для разных типов сложности (Single-hop / Multi-hop)'
---

# 20-rag-sources-and-scope

<context>
Определить источники данных для покрытия `IN-NEED-XXX`. Оценить пригодность структуры источников для генерации сложных вопросов (Multi-hop) и выявить ограничения по "шуму" (Context Relevancy).
</context>

<inputs>
- `target/rag_dataset_spec/02_info_needs.md` — потребности с типами сложности.
- `input/03_sources_inventory.md` — инвентарь систем.
</inputs>

<outputs>
- `target/rag_dataset_spec/03_sources_and_scope.md` — карта источников, статус (Primary/Secondary), пригодность для графа знаний.
- PDR: `pdrs/YYYY-MM-DDTHH-MM-SS_20-rag-sources-and-scope.md`
</outputs>

<steps>
1) **Маппинг источников:** Для каждого `IN-NEED-XXX` выбрать источники (Primary/Secondary).

2) **Оценка пригодности для Multi-hop (Knowledge Graph Readiness):**
   - Проанализировать, есть ли в источниках явные связи (ссылки, общие ID сущностей), позволяющие соединить разные документы.
   - *Критерий:* Если связи есть — источник подходит для **Multi-hop** вопросов. Если нет — только для **Single-hop**.

3) **Оценка "Сигнал/Шум" (Context Relevancy Risk):**
   - Оценить структуру документов: насколько они "чистые" или зашумлены (колонтитулы, сканы, логи).
   - Если источник "грязный" — поставить флаг риска для метрики Context Relevancy.

4) **Фильтрация и Границы:**
   - Задать фильтры (даты, статусы, типы файлов).
   - Исключить источники, не проходящие по ИБ/Лицензиям.

5) **Gap-анализ:**
   - Если для потребности типа **Reasoning/Multi-hop** нет подходящего связного источника — зафиксировать риск "Невозможно сгенерировать сложные вопросы без синтетики".
</steps>

<constraints>
- Не назначать разрозненные/плоские источники (flat files) как основу для Multi-hop вопросов без оговорки о необходимости извлечения сущностей (NER).
- Явно указывать статус Excluded для источников с высоким риском галлюцинаций (черновики, невалидированные данные).
</constraints>

<audit_log>
- В PDR отметить: какие источники отвергнуты из-за структуры (нельзя построить граф), какие приняты с ограничениями.
</audit_log>